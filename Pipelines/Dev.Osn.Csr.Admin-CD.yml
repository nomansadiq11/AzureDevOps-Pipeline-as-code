
steps:
- task: WindowsMachineFileCopy@1
  displayName: 'Backup existing Host files'
  inputs:
    SourcePath: '\\$(ServerIP)\$(Osn.Hosts.Escl.Management.WebHost)\'
    EnvironmentName: '$(ServerIP)'
    AdminUserName: '$(ServerLogin)'
    AdminPassword: '$(ServerPW)'
    TargetPath: '$(BackupPath)\Backup\$(Release.DefinitionName)\$(Release.ReleaseName)\'
  
- task: WindowsMachineFileCopy@1
  displayName: 'Copy Build files'
  inputs:
    SourcePath: '$(System.DefaultWorkingDirectory)/_QA.Osn.Hosts.Escl.Management.WebHost-CI/drop/_PublishedWebsites/Osn.Hosts.Escl.Management.WebHost'
    EnvironmentName: '$(ServerIP)'
    AdminUserName: '$(ServerLogin)'
    AdminPassword: '$(ServerPW)'
    TargetPath: '$(BackupPath)\Deployment\$(Release.DefinitionName)\$(Release.ReleaseName)\'

- task: DeleteFiles@1
  displayName: 'Delete files bin, config and cache files'
  inputs:
    SourceFolder: '\\$(ServerIP)\$(BackupPath)\Deployment\$(Release.DefinitionName)\$(Release.ReleaseName)\'
    Contents: |
     **.config
     **\bin\*.exe
     **\bin\Osn.Runtime.RealCaching.dll
     **\bin\*.config
     **\bin\Entriq.IBS.Exceptions.dll
     
- task: CopyFiles@1
  displayName: 'Copy Files to: \\$(ServerIP)\$(Osn.Hosts.Escl.Management.WebHost)'
  inputs:
    SourceFolder: '\\$(ServerIP)\$(BackupPath)\Deployment\$(Release.DefinitionName)\$(Release.ReleaseName)\'
    Contents: |
     **\*
     * 
     **\*
     **\bin\**
    TargetFolder: '\\$(ServerIP)\$(Osn.Hosts.Escl.Management.WebHost)'
    OverWrite: true